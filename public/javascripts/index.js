!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e){e.exports={frames:{pac_man_down_0:{frame:{x:0,y:0,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_down_1:{frame:{x:99,y:0,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_down_2:{frame:{x:33,y:0,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_down_3:{frame:{x:0,y:66,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_left_0:{frame:{x:163,y:231,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_left_1:{frame:{x:33,y:66,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_left_2:{frame:{x:33,y:132,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_left_3:{frame:{x:66,y:0,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_right_0:{frame:{x:99,y:99,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_right_1:{frame:{x:0,y:132,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_right_2:{frame:{x:163,y:198,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_right_3:{frame:{x:165,y:33,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_up_0:{frame:{x:99,y:66,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_up_1:{frame:{x:66,y:50,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_up_2:{frame:{x:33,y:33,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},pac_man_up_3:{frame:{x:165,y:0,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_down_0:{frame:{x:66,y:132,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_down_1:{frame:{x:130,y:198,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_down_2:{frame:{x:165,y:99,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_left_0:{frame:{x:97,y:231,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_left_1:{frame:{x:132,y:33,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_left_2:{frame:{x:99,y:33,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_right_0:{frame:{x:0,y:99,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_right_1:{frame:{x:97,y:165,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_right_2:{frame:{x:132,y:132,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_top_0:{frame:{x:132,y:0,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_top_1:{frame:{x:130,y:231,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_pacdeath_up_2:{frame:{x:97,y:198,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_cherry:{frame:{x:66,y:99,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_ghost_blue:{frame:{x:132,y:99,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_afraid_1:{frame:{x:132,y:66,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_afraid_0:{frame:{x:165,y:66,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_ghost_orange:{frame:{x:0,y:33,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_ghost_pink:{frame:{x:33,y:99,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_ghost_red:{frame:{x:99,y:132,w:32,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:32,h:32},sourceSize:{w:32,h:32}},spr_lifecounter_0:{frame:{x:66,y:33,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16}},spr_enter_0:{frame:{x:0,y:264,w:192,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:192,h:32},sourceSize:{w:192,h:32}},spr_message_0:{frame:{x:0,y:198,w:96,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:96,h:32},sourceSize:{w:96,h:32}},spr_message_1:{frame:{x:0,y:165,w:96,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:96,h:32},sourceSize:{w:96,h:32}},spr_message_2:{frame:{x:0,y:231,w:96,h:32},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:96,h:32},sourceSize:{w:96,h:32}},spr_pill_0:{frame:{x:130,y:182,w:8,h:8},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:8,h:8},sourceSize:{w:8,h:8}},spr_power_pill:{frame:{x:130,y:165,w:16,h:16},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:16,h:16},sourceSize:{w:16,h:16}}},meta:{app:"https://www.leshylabs.com/apps/sstool/",version:"Leshy SpriteSheet Tool v0.8.4",image:"spritesheet.png",size:{w:197,h:296},scale:1}}},function(e){e.exports={height:25,infinite:!1,layers:[{data:[13,3,3,3,3,3,3,3,3,3,3,16,16,16,3,3,3,3,3,3,3,3,3,3,14,12,35,35,35,35,35,35,35,35,35,35,15,1,27,35,35,35,35,35,35,35,35,35,35,12,12,35,13,16,14,35,13,16,16,14,35,15,23,27,35,13,16,16,14,35,13,16,14,35,12,12,35,24,26,25,35,24,26,26,25,35,24,26,25,35,24,26,26,25,35,24,26,25,35,12,12,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,12,12,35,2,3,3,4,35,1,35,2,3,3,16,3,3,4,35,1,35,2,3,3,4,35,12,12,35,35,35,35,35,35,12,35,35,35,35,12,35,35,35,35,12,35,35,35,35,35,35,12,15,16,16,16,16,14,35,15,3,3,4,35,23,35,2,3,3,27,35,13,16,16,16,16,27,15,23,23,23,23,27,35,12,35,35,35,35,35,35,35,35,35,12,35,15,23,23,23,23,27,15,12,12,12,12,27,35,23,35,13,16,16,16,16,16,14,35,23,35,15,12,12,12,12,27,15,12,12,12,12,27,35,35,35,15,1,1,1,1,1,27,35,35,35,15,12,12,12,12,27,15,12,12,12,12,27,35,1,35,24,26,26,26,26,26,25,35,1,35,15,12,12,12,12,27,15,12,12,12,12,27,35,12,35,35,35,35,35,35,35,35,35,12,35,15,12,12,12,12,27,15,12,12,12,12,27,35,12,35,2,3,3,16,3,3,4,35,12,35,15,12,12,12,12,27,15,1,1,1,1,27,35,12,35,35,35,35,12,35,35,35,35,12,35,15,1,1,1,1,27,15,26,26,26,26,25,35,23,35,13,14,35,23,35,13,14,35,23,35,24,26,26,26,26,27,12,35,35,35,35,35,35,35,35,15,27,35,35,35,15,27,35,35,35,35,35,35,35,35,12,12,35,2,3,16,14,35,2,3,26,26,4,35,2,26,26,3,4,35,13,16,3,4,35,12,12,35,35,35,15,27,35,35,35,35,35,35,35,35,35,35,35,35,35,15,27,35,35,35,12,15,16,14,35,15,27,35,1,35,2,3,3,16,3,3,4,35,1,35,15,27,35,13,16,27,15,26,25,35,24,25,35,12,35,35,35,35,12,35,35,35,35,12,35,24,25,35,24,26,27,12,35,35,35,35,35,35,15,16,16,14,35,23,35,13,16,16,27,35,35,35,35,35,35,12,12,35,2,3,3,3,3,26,26,26,25,35,35,35,24,26,26,26,3,3,3,3,4,35,12,12,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,12,24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25],height:25,id:2,name:"Слой тайлов 1",opacity:1,type:"tilelayer",visible:!0,width:25,x:0,y:0},{height:7,name:"my_objects",objects:[{gid:21,height:32,name:"pacman",properties:{},type:"Pacman",visible:!0,width:32,x:32,y:32}],opacity:1,type:"objectgroup",visible:!0,width:8,x:0,y:0}],nextlayerid:3,nextobjectid:1,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.2.1",tileheight:32,tilesets:[{columns:11,firstgid:1,image:"background2.png",imageheight:199,imagewidth:362,margin:0,name:"background2",spacing:0,tilecount:66,tileheight:32,tilewidth:32}],tilewidth:32,type:"map",version:1.2,width:25}},function(e){e.exports={height:25,infinite:!1,layers:[{data:[13,3,3,3,3,3,3,16,16,16,16,16,16,16,16,16,16,16,3,3,3,3,3,3,14,12,35,35,35,35,35,35,15,16,16,16,16,16,16,16,16,16,27,35,35,35,35,35,35,12,12,35,2,3,3,4,35,15,16,16,16,16,16,16,16,16,16,27,35,2,3,3,4,35,12,12,35,35,35,35,35,35,15,16,16,16,16,16,16,16,16,16,27,35,35,35,35,35,35,12,12,35,2,3,3,4,35,15,16,16,16,16,16,16,16,16,16,27,35,2,3,3,4,35,12,12,35,35,35,35,35,35,15,16,16,16,16,16,16,16,16,16,27,35,35,35,35,35,35,12,12,35,2,3,3,4,35,15,16,16,16,16,16,16,16,16,16,27,35,2,3,3,4,35,12,12,35,35,35,35,35,35,15,3,3,3,3,3,3,3,3,3,27,35,35,35,35,35,35,12,15,16,16,16,16,14,35,12,35,35,35,35,35,35,35,35,35,12,35,13,16,16,16,16,27,15,26,26,26,26,25,35,23,35,2,3,3,3,3,3,4,35,23,35,24,26,26,26,26,27,12,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,12,12,35,13,16,16,16,16,14,35,34,34,34,34,34,34,34,35,13,16,16,16,16,14,35,12,12,35,24,26,26,26,26,25,35,34,34,34,35,34,34,34,35,24,26,26,26,26,25,35,12,12,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,12,15,16,16,16,16,16,14,35,2,3,3,4,35,2,3,3,4,35,13,16,16,16,16,16,27,15,26,26,26,26,26,25,35,35,35,35,35,35,35,35,35,35,35,24,26,26,26,26,26,27,12,35,35,35,35,35,35,35,13,16,16,14,34,13,16,16,14,35,35,35,35,35,35,35,12,12,35,13,14,35,1,35,13,26,26,26,26,16,26,26,26,26,14,35,1,35,13,14,35,12,12,35,15,27,35,12,35,15,16,16,16,16,16,16,16,16,16,27,35,12,35,15,27,35,12,12,35,24,25,35,23,35,15,16,16,16,16,16,16,16,16,16,27,35,23,35,24,25,35,12,12,35,35,35,35,35,35,15,16,16,16,16,16,16,16,16,16,27,35,35,35,35,35,35,12,12,35,13,14,35,1,35,15,16,16,16,16,26,16,16,16,16,27,35,1,35,13,14,35,12,12,35,24,25,35,23,35,24,3,3,3,25,35,24,3,3,3,25,35,23,35,24,25,35,12,12,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,12,24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25],height:25,id:1,name:"Слой тайлов 1",opacity:1,type:"tilelayer",visible:!0,width:25,x:0,y:0},{height:7,name:"my_objects",objects:[{gid:21,height:32,name:"pacman",properties:{},type:"Pacman",visible:!0,width:32,x:32,y:32}],opacity:1,type:"objectgroup",visible:!0,width:8,x:0,y:0}],nextlayerid:2,nextobjectid:1,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.2.1",tileheight:32,tilesets:[{columns:11,firstgid:1,image:"background2.png",imageheight:199,imagewidth:362,margin:0,name:"background2",spacing:0,tilecount:66,tileheight:32,tilewidth:32}],tilewidth:32,type:"map",version:1.2,width:25}},function(e,t,i){"use strict";i.r(t);class s{static entityAtXY(e,t,i){for(let s=0;s<w.entities.length;s++){const r=w.entities[s];if(r.name!==e.name){if(t+e.size_x-1<r.pos_x||i+e.size_y-1<r.pos_y||t>r.pos_x+r.size_x-1||i>r.pos_y+r.size_y-1)continue;return r}}return null}static update(e){if(0===e.move_x&&0===e.move_y)return f.action[e.direction]=!1,"stop";const t=e.pos_x+Math.floor(e.move_x*e.speed),i=e.pos_y+Math.floor(e.move_y*e.speed),r=t+Math.floor((1===e.move_x||e.move_y?1:0)*(e.size_x-1)),o=i+Math.floor((1===e.move_y||e.move_x?1:0)*(e.size_y-1));let a=x.getTilesetIdx(e.pos_x,e.pos_y);35===a&&(a=x.getTilesetIdx(r,o)),35===a&&(a=x.getTilesetIdx(t,i)),35===a&&(a=x.getTilesetIdx(r,i)),35===a&&(a=x.getTilesetIdx(t,o));let n=s.entityAtXY(e,t,i);return"ghost"===e.name&&35!==a?(function(e){if(1===e.move_x||-1===e.move_x)return e.move_x=0,void(e.move_y=Math.random()<.5?-1:1);-1!==e.move_y&&1!==e.move_y||(e.move_x=Math.random()<.5?-1:1,e.move_y=0)}(e),"break"):(null!==n&&e.onTouchEntity&&(e.onTouchEntity(n),n=null),35!==a&&e.onTouchMap&&e.onTouchMap(a),35!==a||null!==n&&"ghost"!==e.name?(f.action[e.direction]=!1,"break"):(e.pos_x=t,e.pos_y=i,"ghost"===e.name?"move":e.pos_x%32==0&&e.pos_y%32==0?(f.action[e.direction]=!1,"break"):"move"))}}class r{constructor(e,t,i,s){this.pos_x=e,this.pos_y=t,this.size_x=i,this.size_y=s}}class o extends r{constructor({pos_x:e,pos_y:t,size_x:i,size_y:s,move_x:r,move_y:o,speed:a,direction:n,color:h}){super(e,t,i,s),this.name="ghost",this.move_x=r,this.move_y=o,this.speed=a,this.direction=n,this.color=h,this.switchAfraid=!0,this.isEaten=!1}draw(e){let t;if(w.isGhostsAfraid){let e=0;w.isBlink&&(e=this.switchAfraid?0:1,this.switchAfraid=!this.switchAfraid),t=`spr_afraid_${e}`}else t=`spr_ghost_${this.color}`;_.drawSprite(e,t,this.pos_x,this.pos_y)}update(){w.isGhostsAfraid||(this.isEaten=!1),1===this.move_x&&(this.direction="right"),-1===this.move_x&&(this.direction="left"),-1===this.move_y&&(this.direction="up"),1===this.move_y&&(this.direction="down"),s.update(this)}onTouchEntity(e){"pacman"!==e.name||w.isGhostsAfraid||e.isInvulnerable||e.kill()}kill(){w.kill(this)}}class a extends r{constructor({pos_x:e,pos_y:t,size_x:i,size_y:s,lifetime:r,move_x:o,move_y:a,speed:n,direction:h}){super(e,t,i,s),this.name="pacman",this.move_x=o,this.move_y=a,this.speed=n,this.direction=h,this.state=0,this.counterForState=0,this.isInvulnerable=!1}draw(e){this.counterForState++>5&&(this.counterForState=0,this.state++),this.state>3&&(this.state=0),_.drawSprite(e,`pac_man_${this.direction}_${this.state}`,this.pos_x,this.pos_y)}update(){1===this.move_x&&(this.direction="right"),-1===this.move_x&&(this.direction="left"),-1===this.move_y&&(this.direction="up"),1===this.move_y&&(this.direction="down"),s.update(this)}onTouchEntity(e){this.isInvulnerable||("pill"===e.name&&(w.score+=10,e.kill()),"ghost"!==e.name||w.isGhostsAfraid?"ghost"===e.name&&w.isGhostsAfraid&&(e.isEaten||(e.isEaten=!0,w.score+=200,g.play("/sounds/pacman_eatghost.wav"))):this.kill(),"cherry"===e.name&&(w.score+=200,e.kill(),g.play("/sounds/pacman_eatfruit.wav")),document.getElementById("score").innerText=w.score)}kill(){w.doRespawn=!0,w.kill(this)}}class n extends r{constructor({pos_x:e,pos_y:t,size_x:i,size_y:s}){super(e,t,i,s),this.name="cherry"}draw(e){_.drawSprite(e,"spr_cherry",this.pos_x,this.pos_y)}kill(){w.isGhostsAfraid=!0,setTimeout(()=>w.isBlink=!0,4e3),w.kill(this),setTimeout(function(){w.isGhostsAfraid=!1,w.isBlink=!1},6e3)}}class h extends r{constructor({pos_x:e,pos_y:t,size_x:i,size_y:s}){super(e,t,i,s),this.name="pill"}draw(e){_.drawSprite(e,"spr_pill_0",this.pos_x,this.pos_y)}kill(){w.kill(this)}}class l{constructor(){this.mapData=null,this.tLayer=null,this.xCount=0,this.yCount=0,this.tSize={x:64,y:64},this.mapSize={x:64,y:64},this.tilesets=[],this.imgLoadCount=0,this.imgLoaded=!1,this.jsonLoaded=!1}parseMap(e){console.log(e),this.mapData=e,this.xCount=this.mapData.width,this.yCount=this.mapData.height,this.tSize.x=this.mapData.tilewidth,this.tSize.y=this.mapData.tileheight,this.mapSize.x=this.xCount*this.tSize.x,this.mapSize.y=this.yCount*this.tSize.y;for(let e=0;e<this.mapData.tilesets.length;e++){const t=new Image;t.onload=(()=>{this.imgLoadCount+=1,this.imgLoadCount===this.mapData.tilesets.length&&(this.imgLoaded=!0)});const i=this.mapData.tilesets[e];t.src=i.image;const s={firstgid:i.firstgid,image:t,name:i.name,xCount:Math.floor(i.imagewidth/this.tSize.x),yCount:Math.floor(i.imageheight/this.tSize.y)};this.tilesets.push(s)}this.jsonLoaded=!0}getTileset(e){for(let t=this.tilesets.length-1;t>=0;t--)if(this.tilesets[t].firstgid<=e)return this.tilesets[t];return null}getTile(e){const t={img:null,px:0,py:0},i=this.getTileset(e);t.img=i.image;const s=e-i.firstgid,r=s%i.xCount,o=Math.floor(s/i.xCount);return t.px=r*this.tSize.x,t.py=o*this.tSize.y,t}draw(e){if(this.imgLoaded&&this.jsonLoaded){if(null===this.tLayer)for(let e=0;e<this.mapData.layers.length;e++){const t=this.mapData.layers[e];if("tilelayer"===t.type){this.tLayer=t;break}}for(let t=0;t<this.tLayer.data.length;t++)if(0!==this.tLayer.data[t]){const i=this.getTile(this.tLayer.data[t]);let s=t%this.xCount*this.tSize.x,r=Math.floor(t/this.xCount)*this.tSize.y;e.drawImage(i.img,i.px,i.py,this.tSize.x,this.tSize.y,s,r,this.tSize.x,this.tSize.y)}}else setTimeout(()=>this.draw(e),100)}parseEntities(){if(this.imgLoaded&&this.jsonLoaded){for(let e=0;e<this.mapData.layers.length;e++)if("objectgroup"===this.mapData.layers[e].type){const t=this.mapData.layers[e];for(let e=0;e<t.objects.length;e++){const i=t.objects[e];try{const e=w.factory[i.type]();e.name=i.name,e.pos_x=i.x,e.pos_y=i.y,e.size_x=i.width,e.size_y=i.height,w.entities.push(e),"pacman"===e.name&&w.initPlayer(e)}catch(e){console.log(`Error while creating: [${i.gid}] ${i.type}, ${e}`)}}}}else setTimeout(()=>this.parseEntities(),100)}getTilesetIdx(e,t){const i=e,s=t,r=Math.floor(s/this.tSize.y)*this.xCount+Math.floor(i/this.tSize.x);return this.tLayer.data[r]}}var c=i(0);var p=i(1),d=i(2);i.d(t,"spriteManager",function(){return _}),i.d(t,"gameManager",function(){return w}),i.d(t,"mapManager",function(){return x}),i.d(t,"eventsManager",function(){return f}),i.d(t,"soundManager",function(){return g});const m=[p,d],u=document.querySelector("canvas");u.width=640,u.height=640;const y=u.getContext("2d");y.scale(.8,.8),document.getElementById("nextlvl-btn").addEventListener("click",function(){y.clearRect(0,0,u.width,u.height),document.getElementById("nextlvl-btn").setAttribute("disabled","disabled"),w.clearManager(),S()});const _=new class{constructor(){this.image=new Image,this.sprites=[],this.imgLoaded=!1,this.jsonLoaded=!1}parseAtlas(e){const t=e;for(let e in t.frames){const i=t.frames[e].frame;this.sprites.push({name:e,x:i.x,y:i.y,w:i.w,h:i.h})}this.jsonLoaded=!0}loadImage(e){this.image.onload=(()=>{this.imgLoaded=!0}),this.image.src=e}getSprite(e){for(let t=0;t<this.sprites.length;t++){const i=this.sprites[t];if(i.name===e)return i}return null}drawSprite(e,t,i,s){if(this.imgLoaded&&this.jsonLoaded){const r=this.getSprite(t);e.drawImage(this.image,r.x,r.y,r.w,r.h,i,s,r.w,r.h)}else setTimeout(()=>this.drawSprite(e,t,i,s),100)}loadAtlas(){this.loadImage("../spritesheet.png"),this.parseAtlas(c)}};let x,w=new class{constructor(){this.factory={},this.entities=[],this.player=null,this.laterKill=[],this.score=0,this.finalScore=0,this.numOfTries=3,this.isGhostsAfraid=!1,this.isBlink=!1,this.doRespawn=!1,this.gameOver=!1,this.currentLevel=1,this.onlyOnce=!0,this.maxLevelsNum=2}initPlayer(e){this.player=e}kill(e){this.laterKill.push(e)}update(e){if(this.doRespawn&&this.numOfTries>0){this.numOfTries--,this.doRespawn=!1;let e=new a({pos_x:32,pos_y:32,size_x:32,size_y:32,move_x:0,move_y:0,speed:8,direction:"right"});this.entities.push(e),this.initPlayer(e),g.play("/sounds/pacman_death.wav")}else this.doRespawn&&0===this.numOfTries&&(this.gameOver=!0);if(null===this.player&&!this.gameOver)return;this.player.move_x=0,this.player.move_y=0,f.action.up&&(this.player.move_y=-1),f.action.down&&(this.player.move_y=1),f.action.left&&(this.player.move_x=-1),f.action.right&&(this.player.move_x=1);let t=!0;this.entities.forEach(e=>{"pill"===e.name&&(t=!1);try{e.update()}catch(e){}});for(let e=0;e<this.laterKill.length;e++){const t=this.entities.indexOf(this.laterKill[e]);t>-1&&this.entities.splice(t,1)}this.laterKill.length&&(this.laterKill.length=0),x.draw(e),e.strokeStyle="#FFFF00",e.font="bold 32px sans-serif",e.strokeText(w.numOfTries,32,28),_.drawSprite(e,"spr_lifecounter_0",8,8),this.gameOver?(this.updateLocalStorage(),e.font="bold 100px sans-serif",e.strokeText("GAME OVER",100,430)):t&&(this.onlyOnce&&(this.currentLevel<this.maxLevelsNum&&(document.getElementById("nextlvl-btn").disabled=!1,this.currentLevel++),g.play("/sounds/pacman_death.wav")),this.onlyOnce=!1,this.player.isInvulnerable=!0,this.updateLocalStorage(),e.font="bold 100px sans-serif",e.strokeText("VICTORY",180,400)),this.draw(e)}draw(e){for(let t=0;t<this.entities.length;t++)this.entities[t].draw(e,this.player)}clearManager(){clearInterval(this.playInterval),this.finalScore=this.score,this.entities=[],this.player=null,this.laterKill=[],this.score=0,this.numOfTries=3,this.isGhostsAfraid=!1,this.isBlink=!1,this.doRespawn=!1,this.gameOver=!1}play(e){document.getElementById("player").innerText=localStorage["pacman.username"]+": ",this.playInterval=setInterval(()=>w.update(e),30)}updateLocalStorage(){localStorage.hasOwnProperty(localStorage["pacman.username"])?localStorage[localStorage["pacman.username"]]<this.score+this.finalScore&&(localStorage[localStorage["pacman.username"]]=this.score+this.finalScore):localStorage[localStorage["pacman.username"]]=this.score+this.finalScore}};const f=new class{constructor(){this.bind=[],this.action=[]}setup(e){this.bind[87]="up",this.bind[65]="left",this.bind[83]="down",this.bind[68]="right",document.body.addEventListener("keydown",e=>this.onKeyDown(e))}onKeyDown(e){const t=this.bind[e.keyCode];t&&(this.action[t]=!0)}};let g=new class{constructor(){this.clips={},this.context=null,this.gainNode=null,this.loaded=!1}init(){this.context=new AudioContext,this.gainNode=this.context.createGain?this.context.createGain():this.context.createGainNode(),this.gainNode.connect(this.context.destination)}load(e,t){if(this.clips[e])return void t(this.clips[e]);const i={path:e,buffer:null,loaded:!1};i.play=((e,t)=>{this.play(this.path,{looping:t||!1,volume:e||1})}),this.clips[e]=i;const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=(()=>{this.context.decodeAudioData(s.response,e=>{i.buffer=e,i.loaded=!0,t(i)})}),s.send()}loadArray(e){for(let t=0;t<e.length;t++)this.load(e[t],()=>{if(e.length===Object.keys(this.clips).length){for(let e in this.clips)if(!this.clips[e].loaded)return;this.loaded=!0}})}play(e,t){if(!this.loaded)return void setTimeout(()=>this.play(e,t),1e3);let i=!1,s=1;t&&(t.looping&&(i=t.looping),t.volume&&(s=t.volume));const r=this.clips[e];if(null===r)return!1;const o=this.context.createBufferSource();return o.buffer=r.buffer,o.connect(this.gainNode),o.loop=i,this.gainNode.gain.value=s,o.start(0),!0}};function S(){x=new l,console.log("ind = ",w.currentLevel-1),x.parseMap(m[w.currentLevel-1]),_.loadAtlas(),x.parseEntities(),function(){if(null===x.tLayer)for(let e=0;e<x.mapData.layers.length;e++){const t=x.mapData.layers[e];if("tilelayer"===t.type)for(let e=0;e<t.data.length;e++)if(0!==t.data[e]){let i=e%x.xCount*x.tSize.x,s=Math.floor(e/x.xCount)*x.tSize.y;35===t.data[e]&&w.entities.push(new h({pos_x:i+12,pos_y:s+12,size_x:16,size_y:16}))}}}(),w.entities.push(new o({pos_x:736,pos_y:32,size_x:32,size_y:32,move_x:-1,move_y:0,speed:4,direction:"left",color:"blue"})),w.entities.push(new o({pos_x:736,pos_y:736,size_x:32,size_y:32,move_x:-1,move_y:0,speed:4,direction:"left",color:"orange"})),w.entities.push(new o({pos_x:32,pos_y:736,size_x:32,size_y:32,move_x:1,move_y:0,speed:4,direction:"right",color:"pink"})),w.entities.push(new o({pos_x:384,pos_y:384,size_x:32,size_y:32,move_x:-1,move_y:0,speed:4,direction:"left",color:"red"})),w.entities.push(new n({pos_x:384,pos_y:256,size_x:32,size_y:32})),w.entities.push(new n({pos_x:384,pos_y:704,size_x:32,size_y:32})),w.entities.push(new n({pos_x:736,pos_y:512,size_x:32,size_y:32})),w.entities.push(new n({pos_x:32,pos_y:512,size_x:32,size_y:32})),f.setup(u),x.draw(y),w.play(y)}g.init(),g.loadArray(["/sounds/pacman_beginning.wav","/sounds/pacman_death.wav","/sounds/pacman_eatfruit.wav","/sounds/pacman_eatghost.wav"]),g.play("/sounds/pacman_beginning.wav"),w.factory.Pacman=(()=>new a({pos_x:32,pos_y:32,size_x:32,size_y:32,move_x:0,move_y:0,speed:8,direction:"right"})),S()}]);